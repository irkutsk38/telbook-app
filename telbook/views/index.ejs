<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</title>
  <link rel="stylesheet" href="/style.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f5f5f5; }
    header { background: #333; color: white; padding: 1rem; text-align: center; }
    nav a { color: white; margin: 0 10px; text-decoration: none; }
    main { padding: 1.5rem; }
    section { background: white; margin: 1.5rem 0; padding: 1rem; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    input, select, button { padding: 6px 10px; margin: 4px; border: 1px solid #ccc; border-radius: 4px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
    th { background: #f0f0f0; }
    label { display: inline-block; margin-right: 10px; }
    footer { text-align: center; padding: 1rem; background: #333; color: white; margin-top: 2rem; }
  </style>
</head>
<body>
  <header>
    <h1>üìû –¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫</h1>
    <nav>
      <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
      <a href="/reports/cities">–ì–æ—Ä–æ–¥–∞</a>
      <a href="/reports/persons">–§–∏–∑–ª–∏—Ü–∞</a>
      <a href="/reports/organizations">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</a>
      <a href="/reports/by-rubric">–ü–æ —Ä—É–±—Ä–∏–∫–µ</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>üîç –ü–æ–∏—Å–∫</h2>
      <form method="GET" action="/search">
        <label>
          –§–∞–º–∏–ª–∏—è:
          <input type="text" name="surname" value="<%= (typeof search !== 'undefined' && search.surname) ? search.surname : '' %>">
        </label>
        <label>
          –ì–æ—Ä–æ–¥:
          <select name="city_id">
            <option value="all">–í—Å–µ</option>
            <% if (typeof cities !== 'undefined') { %>
              <% cities.forEach(c => { %>
                <option value="<%= c.city_id %>" 
                  <%= (typeof search !== 'undefined' && search.city_id == c.city_id) ? 'selected' : '' %>>
                  <%= c.city_name %>
                </option>
              <% }) %>
            <% } %>
          </select>
        </label>
        <label>
          –†—É–±—Ä–∏–∫–∞:
          <select name="category_id">
            <option value="all">–í—Å–µ</option>
            <% if (typeof categories !== 'undefined') { %>
              <% categories.forEach(cat => { %>
                <option value="<%= cat.category_id %>"
                  <%= (typeof search !== 'undefined' && search.category_id == cat.category_id) ? 'selected' : '' %>>
                  <%= cat.category_name %>
                </option>
              <% }) %>
            <% } %>
          </select>
        </label>
        <button type="submit">–ù–∞–π—Ç–∏</button>
      </form>
    </section>
    <section>
      <h2>üóÇÔ∏è –î–æ–±–∞–≤–∏—Ç—å —Ä—É–±—Ä–∏–∫—É</h2>
      <form method="POST" action="/add-category">
        <input type="text" name="category_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä—É–±—Ä–∏–∫–∏" required>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —Ä—É–±—Ä–∏–∫—É</button>
      </form>
    </section>
    <section>
      <h2>üèôÔ∏è –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥</h2>
      <form method="POST" action="/add-city">
        <input type="text" name="city_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞" required>
        <input type="text" name="phone_code" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∫–æ–¥" required>
        <select name="country_id" required>
          <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É ‚Äî</option>
          <% if (typeof countries !== 'undefined') { %>
            <% countries.forEach(co => { %>
              <option value="<%= co.country_id %>"><%= co.country_name %></option>
            <% }) %>
          <% } else { %>
            <option value="1">–†–æ—Å—Å–∏—è</option>
          <% } %>
        </select>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥</button>
      </form>
    </section>
    <section>
      <h2>üë§ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</h2>
      <form method="POST" action="/add-person">
        <input type="text" name="surname" placeholder="–§–∞–º–∏–ª–∏—è" required>
        <input type="text" name="name" placeholder="–ò–º—è" required>
        <input type="text" name="patronymic" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ">
        <input type="text" name="streetname" placeholder="–£–ª–∏—Ü–∞" required>
        <input type="text" name="homenumber" placeholder="–î–æ–º" required>
        <input type="text" name="building" placeholder="–ö–æ—Ä–ø—É—Å">
        <input type="text" name="apartment" placeholder="–ö–≤–∞—Ä—Ç–∏—Ä–∞">
        <input type="text" name="phone_number" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required>
        <select name="city_id" required>
          <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ ‚Äî</option>
          <% if (typeof cities !== 'undefined') { %>
            <% cities.forEach(c => { %>
              <option value="<%= c.city_id %>"><%= c.city_name %></option>
            <% }) %>
          <% } %>
        </select>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</button>
      </form>
    </section>
    <section>
      <h2>üè¢ –î–æ–±–∞–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é</h2>
      <form method="POST" action="/add-org" id="orgForm">
        <input type="text" name="org_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏" required>
        <input type="text" name="streetname" placeholder="–£–ª–∏—Ü–∞" required>
        <input type="text" name="homenumber" placeholder="–î–æ–º" required>
        <input type="text" name="building" placeholder="–ö–æ—Ä–ø—É—Å">
        <input type="text" name="office" placeholder="–û—Ñ–∏—Å">
        <select name="city_id" required>
          <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ ‚Äî</option>
          <% if (typeof cities !== 'undefined') { %>
            <% cities.forEach(c => { %>
              <option value="<%= c.city_id %>"><%= c.city_name %></option>
            <% }) %>
          <% } %>
        </select>
        <select name="category_id" required>
          <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ —Ä—É–±—Ä–∏–∫—É ‚Äî</option>
          <% if (typeof categories !== 'undefined') { %>
            <% categories.forEach(cat => { %>
              <option value="<%= cat.category_id %>"><%= cat.category_name %></option>
            <% }) %>
          <% } %>
        </select>

        <div id="phones">
          <input type="text" name="phones" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω 1" required>
        </div>
        <button type="button" onclick="addPhone()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω</button>
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é</button>
      </form>
    </section>
    <section>
      <h2>üë§ –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ª–∏—Ü–∞</h2>
      <% if (typeof persons !== 'undefined' && persons.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>–§–∞–º–∏–ª–∏—è</th>
              <th>–ò–º—è</th>
              <th>–û—Ç—á–µ—Å—Ç–≤–æ</th>
              <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
              <th>–ì–æ—Ä–æ–¥</th>
              <th>–ê–¥—Ä–µ—Å</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <% persons.forEach(p => { %>
              <tr>
                <td><%= p.surname %></td>
                <td><%= p.name %></td>
                <td><%= p.patronymic || '' %></td>
                <td><%= p.phone_number %></td>
                <td><%= p.city_name %></td>
                <td>
                  <%= p.streetname %> <%= p.homenumber %>
                  <%= p.building ? ', –∫–æ—Ä–ø. ' + p.building : '' %>
                  <%= p.apartment ? ', –∫–≤. ' + p.apartment : '' %>
                </td>
                <td>
                  <a href="/delete-person/<%= p.person_id %>" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>–ù–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü.</p>
      <% } %>
    </section>
    <section>
      <h2>üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</h2>
      <% if (typeof orgs !== 'undefined' && orgs.length > 0) { %>
        <table>
          <thead>
            <tr>
              <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
              <th>–†—É–±—Ä–∏–∫–∞</th>
              <th>–¢–µ–ª–µ—Ñ–æ–Ω—ã</th>
              <th>–ì–æ—Ä–æ–¥</th>
              <th>–ê–¥—Ä–µ—Å</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody>
            <% orgs.forEach(o => { %>
              <tr>
                <td><%= o.org_name %></td>
                <td><%= o.category_name %></td>
                <td><%= o.phones || '‚Äî' %></td>
                <td><%= o.city_name %></td>
                <td>
                  <%= o.streetname %> <%= o.homenumber %>
                  <%= o.building ? ', –∫–æ—Ä–ø. ' + o.building : '' %>
                  <%= o.office ? ', –æ—Ñ. ' + o.office : '' %>
                </td>
                <td>
                  <a href="/delete-org/<%= o.org_id %>" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∏ –≤—Å–µ –µ—ë —Ç–µ–ª–µ—Ñ–æ–Ω—ã?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>–ù–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.</p>
      <% } %>
    </section>
  </main>

  <script>
    function addPhone() {
      const container = document.getElementById('phones');
      const input = document.createElement('input');
      input.type = 'text';
      input.name = 'phones';
      input.placeholder = '–¢–µ–ª–µ—Ñ–æ–Ω';
      input.style.margin = '4px';
      input.style.padding = '6px 10px';
      input.style.border = '1px solid #ccc';
      input.style.borderRadius = '4px';
      container.appendChild(input);
    }
  </script>

<section>
  <h2>üèôÔ∏è –ì–æ—Ä–æ–¥–∞</h2>
  <% if (typeof cities !== 'undefined' && cities.length > 0) { %>
    <table border="1">
      <thead>
        <tr>
          <th>–ì–æ—Ä–æ–¥</th>
          <th>–ö–æ–¥</th>
          <th>–°—Ç—Ä–∞–Ω–∞</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        <% cities.forEach(c => { %>
          <tr>
            <td><%= c.city_name %></td>
            <td><%= c.phone_code %></td>
            <td>
              <% if (typeof countries !== 'undefined') { %>
                <% const country = countries.find(co => co.country_id == c.country_id); %>
                <%= country ? country.country_name : '‚Äî' %>
              <% } else { %>
                (–∑–∞–≥—Ä—É–∑–∫–∞...)
              <% } %>
            </td>
            <td>
              <a href="/edit-city/<%= c.city_id %>" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
              <a href="/delete-city/<%= c.city_id %>" 
                 onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –≥–æ—Ä–æ–¥? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω—ã!')"
                 title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>–ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤.</p>
  <% } %>

  <form method="POST" action="/add-city" style="margin-top: 1rem;">
    <input type="text" name="city_name" placeholder="–ì–æ—Ä–æ–¥" required style="width: 120px;">
    <input type="text" name="phone_code" placeholder="–ö–æ–¥" required style="width: 80px;">
    <select name="country_id" required style="width: 120px;">
      <% if (typeof countries !== 'undefined') { %>
        <% countries.forEach(co => { %>
          <option value="<%= co.country_id %>"><%= co.country_name %></option>
        <% }) %>
      <% } else { %>
        <option value="1">–†–æ—Å—Å–∏—è</option>
      <% } %>
    </select>
    <button type="submit">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥</button>
  </form>
</section>

<section>
  <h2>üóÇÔ∏è –†—É–±—Ä–∏–∫–∏</h2>
  <% if (typeof categories !== 'undefined' && categories.length > 0) { %>
    <table border="1">
      <thead>
        <tr>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        <% categories.forEach(cat => { %>
          <tr>
            <td><%= cat.category_name %></td>
            <td>
              <a href="/edit-category/<%= cat.category_id %>" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
              <a href="/delete-category/<%= cat.category_id %>" 
                 onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ä—É–±—Ä–∏–∫—É?')"
                 title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>–ù–µ—Ç —Ä—É–±—Ä–∏–∫.</p>
  <% } %>
  <form method="POST" action="/add-category" style="margin-top: 1rem;">
    <input type="text" name="category_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä—É–±—Ä–∏–∫–∏" required>
    <button type="submit">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä—É–±—Ä–∏–∫—É</button>
  </form>
</section>

<section>
  <h2>üåç –°—Ç—Ä–∞–Ω—ã</h2>
  <% if (typeof countries !== 'undefined' && countries.length > 0) { %>
    <table border="1">
      <thead>
        <tr>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        <% countries.forEach(co => { %>
          <tr>
            <td><%= co.country_name %></td>
            <td>
              <a href="/edit-country/<%= co.country_id %>" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
              <a href="/delete-country/<%= co.country_id %>" 
                 onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω—É?')"
                 title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } else { %>
    <p>–ù–µ—Ç —Å—Ç—Ä–∞–Ω.</p>
  <% } %>
  <form method="POST" action="/add-country" style="margin-top: 1rem;">
    <input type="text" name="country_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã" required>
    <button type="submit">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω—É</button>
  </form>
</section>
  <footer>
    &copy; 2025 –¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫
  </footer>
</body>
</html>